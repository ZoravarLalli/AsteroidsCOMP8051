//
//  CubeModel.m
//  Project1
//
//  Created by Kris Olsson on 2021-02-24.
//

#import "ProjectileModel.h"
#import "AsteroidModel.h"

@implementation ProjectileModel

//Initiation method inherited from Model.m
- (instancetype) initWithShader:(BaseEffect *) shader
{
    //Initialize cube with shader and vertex data.
    if(self = [super initWithName:"projectile"
                           shader:shader
                         vertices:(Vertex *)vertices
                      vertexCount:sizeof(vertices)/sizeof(vertices[0])])
    {
        //Set texture from Resource folder
        [self loadTexture:@"ProjectileTexture.png"];
        self.rotationX = M_PI/2;
    }
    return self;
}

//Update method interited from Model.m
-(void)updateWithDelta:(NSTimeInterval)delta
{
    self.timeAlive += delta;
    if (self.timeAlive > .3)
    {
        self.destroy = true;
    }
    //Send the projectile on a trajectory based on its forward vector.
    GLKVector3 velocity = GLKVector3MultiplyScalar(self.forward, 3);
    self.position = GLKVector3Add(self.position, velocity);
    
    //Check for asteroid collision
    for(AsteroidModel *ast in _asteroids)
    {
        
        if(self.position.x + (2 * ast.scale) >= ast.position.x
           && self.position.x - (2 * ast.scale) <= ast.position.x
           && self.position.y + (2 * ast.scale) >= ast.position.y
           && self.position.y - (2 * ast.scale) <= ast.position.y)
        {
            ast.destroy = true;
            self.destroy = true;
        }
    }
    
    //Check for enemy collision

    if(_enemy != nil
       && self.position.x + (3.2) >= _enemy.position.x
       && self.position.x - (3.2) <= _enemy.position.x
       && self.position.y + (3) >= _enemy.position.y
       && self.position.y - (3) <= _enemy.position.y)
    {
        _enemy.destroy = true;
        self.destroy = true;
    }

    
    
    //Check if projectile is beyond bounds of the screen.
    if(self.position.x > _xBound)
    {
        self.position = GLKVector3Make(_xBound * -1, self.position.y, self.position.z);
    }
    else if (self.position.x < _xBound * -1)
    {
        self.position = GLKVector3Make(_xBound, self.position.y, self.position.z);
    }
    else if (self.position.y > _yBound)
    {
        self.position = GLKVector3Make(self.position.x, _yBound * -1, self.position.z);
    }
    else if (self.position.y < _yBound * -1)
    {
        self.position = GLKVector3Make(self.position.x, _yBound, self.position.z);
    }
}

const static Vertex vertices[] = {
    {{0.000000, 0.803655, 0.028502}, {1, 1, 1, 1}, {0.923090, 0.945055}, {-0.182300, 0.932200, -0.312800}},
    {{0.237148, 0.525699, -0.937995}, {1, 1, 1, 1}, {0.787536, 0.724971}, {-0.182300, 0.932200, -0.312800}},
    {{-0.090581, 0.525699, -0.747011}, {1, 1, 1, 1}, {0.880561, 0.742084}, {-0.182300, 0.932200, -0.312800}},
    {{0.403463, 0.750643, -0.721281}, {1, 1, 1, 1}, {0.764735, 0.801636}, {-0.580300, 0.745300, -0.328300}},
    {{0.237148, 0.525699, -0.937995}, {1, 1, 1, 1}, {0.787536, 0.724971}, {-0.580300, 0.745300, -0.328300}},
    {{0.167020, 0.896775, 0.028502}, {1, 1, 1, 1}, {0.882977, 0.964127}, {-0.580300, 0.745300, -0.328300}},
    {{0.000000, 0.803655, 0.028502}, {1, 1, 1, 1}, {0.923090, 0.945055}, {0.255700, 0.900200, -0.352500}},
    {{-0.090581, 0.525699, -0.747011}, {1, 1, 1, 1}, {0.880561, 0.742084}, {0.255700, 0.900200, -0.352500}},
    {{-0.103224, 0.832979, 0.028502}, {1, 1, 1, 1}, {0.946842, 0.938134}, {0.255700, 0.900200, -0.352500}},
    {{0.403463, 0.750643, -0.721281}, {1, 1, 1, 1}, {0.855046, 0.226157}, {-0.926100, 0.185700, -0.328300}},
    {{0.167020, 0.896775, 0.028502}, {1, 1, 1, 1}, {0.912950, 0.036735}, {-0.926100, 0.185700, -0.328300}},
    {{0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.899252, 0.281635}, {-0.926100, 0.185700, -0.328300}},
    {{-0.154106, 0.750643, 0.597206}, {1, 1, 1, 1}, {0.649056, 0.239721}, {-0.086800, -0.931600, 0.352900}},
    {{0.146568, 0.706863, 0.555568}, {1, 1, 1, 1}, {0.576229, 0.248191}, {-0.086800, -0.931600, 0.352900}},
    {{0.000000, 1.000000, 1.293472}, {1, 1, 1, 1}, {0.598882, 0.079511}, {-0.086800, -0.931600, 0.352900}},
    {{-0.175616, 0.912192, 0.028502}, {1, 1, 1, 1}, {0.955812, 0.355542}, {0.915300, 0.253800, -0.312800}},
    {{-0.383715, 0.706864, -0.747009}, {1, 1, 1, 1}, {0.981093, 0.552203}, {0.915300, 0.253800, -0.312800}},
    {{-0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.899252, 0.600006}, {0.915300, 0.253800, -0.312800}},
    {{0.403463, 0.750643, -0.721281}, {1, 1, 1, 1}, {0.279225, 0.142979}, {0.924100, -0.361100, 0.125300}},
    {{0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.314005, 0.081821}, {0.924100, -0.361100, 0.125300}},
    {{0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.396913, 0.449808}, {0.924100, -0.361100, 0.125300}},
    {{-0.154106, 0.750643, 0.597206}, {1, 1, 1, 1}, {0.221455, 0.447263}, {-0.794500, -0.494300, 0.352900}},
    {{0.000000, 1.000000, 1.293472}, {1, 1, 1, 1}, {0.209631, 0.627292}, {-0.794500, -0.494300, 0.352900}},
    {{-0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.146573, 0.449808}, {-0.794500, -0.494300, 0.352900}},
    {{-0.175616, 0.912192, 0.028502}, {1, 1, 1, 1}, {0.955812, 0.355542}, {0.878000, -0.324700, -0.351700}},
    {{-0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.899252, 0.600006}, {0.878000, -0.324700, -0.351700}},
    {{-0.186735, 1.000000, -0.080314}, {1, 1, 1, 1}, {0.934462, 0.382852}, {0.878000, -0.324700, -0.351700}},
    {{0.154106, 1.249357, 0.597206}, {1, 1, 1, 1}, {0.471795, 0.447263}, {0.522100, 0.844800, 0.116700}},
    {{0.383715, 1.293136, -0.747009}, {1, 1, 1, 1}, {0.402464, 0.115283}, {0.522100, 0.844800, 0.116700}},
    {{0.090581, 1.474301, -0.747011}, {1, 1, 1, 1}, {0.471795, 0.102733}, {0.522100, 0.844800, 0.116700}},
    {{-0.403463, 1.249357, -0.721281}, {1, 1, 1, 1}, {0.687763, 0.567049}, {-0.736200, 0.665100, 0.125300}},
    {{-0.275016, 1.271247, -0.082856}, {1, 1, 1, 1}, {0.715860, 0.407620}, {-0.736200, 0.665100, 0.125300}},
    {{-0.146568, 1.293137, 0.555568}, {1, 1, 1, 1}, {0.743958, 0.248191}, {-0.736200, 0.665100, 0.125300}},
    {{-0.083510, 1.167022, -0.080314}, {1, 1, 1, 1}, {0.657099, 0.928384}, {0.683000, -0.640100, -0.351700}},
    {{-0.237148, 1.474301, -0.937995}, {1, 1, 1, 1}, {0.550797, 0.724971}, {0.683000, -0.640100, -0.351700}},
    {{0.000000, 1.196345, 0.028502}, {1, 1, 1, 1}, {0.686351, 0.945055}, {0.683000, -0.640100, -0.351700}},
    {{-0.083510, 1.167022, -0.080314}, {1, 1, 1, 1}, {0.657099, 0.928384}, {0.218200, -0.905700, -0.363600}},
    {{-0.167020, 1.103225, 0.028502}, {1, 1, 1, 1}, {0.646238, 0.964127}, {0.218200, -0.905700, -0.363600}},
    {{-0.237148, 1.474301, -0.937995}, {1, 1, 1, 1}, {0.550797, 0.724971}, {0.218200, -0.905700, -0.363600}},
    {{-0.167020, 1.103225, 0.028502}, {1, 1, 1, 1}, {0.646238, 0.964127}, {0.580300, -0.745300, -0.328300}},
    {{-0.403463, 1.249357, -0.721281}, {1, 1, 1, 1}, {0.527996, 0.801636}, {0.580300, -0.745300, -0.328300}},
    {{-0.237148, 1.474301, -0.937995}, {1, 1, 1, 1}, {0.550797, 0.724971}, {0.580300, -0.745300, -0.328300}},
    {{-0.237148, 1.474301, -0.937995}, {1, 1, 1, 1}, {0.550797, 0.724971}, {0.182300, -0.932200, -0.312800}},
    {{0.090581, 1.474301, -0.747011}, {1, 1, 1, 1}, {0.643822, 0.742084}, {0.182300, -0.932200, -0.312800}},
    {{0.000000, 1.196345, 0.028502}, {1, 1, 1, 1}, {0.686351, 0.945055}, {0.182300, -0.932200, -0.312800}},
    {{-0.237148, 1.474301, -0.937995}, {1, 1, 1, 1}, {0.736990, 0.609586}, {-0.072500, 0.989600, 0.124400}},
    {{-0.146568, 1.293137, 0.555568}, {1, 1, 1, 1}, {0.743958, 0.248191}, {-0.072500, 0.989600, 0.124400}},
    {{0.090581, 1.474301, -0.747011}, {1, 1, 1, 1}, {0.816786, 0.561931}, {-0.072500, 0.989600, 0.124400}},
    {{-0.146568, 1.293137, 0.555568}, {1, 1, 1, 1}, {0.743958, 0.248191}, {0.120800, 0.980000, 0.158300}},
    {{0.154106, 1.249357, 0.597206}, {1, 1, 1, 1}, {0.816786, 0.239721}, {0.120800, 0.980000, 0.158300}},
    {{0.090581, 1.474301, -0.747011}, {1, 1, 1, 1}, {0.816786, 0.561931}, {0.120800, 0.980000, 0.158300}},
    {{0.090581, 1.474301, -0.747011}, {1, 1, 1, 1}, {0.643822, 0.742084}, {-0.255700, -0.900200, -0.352500}},
    {{0.103224, 1.167021, 0.028502}, {1, 1, 1, 1}, {0.710103, 0.938134}, {-0.255700, -0.900200, -0.352500}},
    {{0.000000, 1.196345, 0.028502}, {1, 1, 1, 1}, {0.686351, 0.945055}, {-0.255700, -0.900200, -0.352500}},
    {{0.090581, 1.474301, -0.747011}, {1, 1, 1, 1}, {0.643822, 0.742084}, {-0.499500, -0.808200, -0.312100}},
    {{0.383715, 1.293136, -0.747009}, {1, 1, 1, 1}, {0.710103, 0.727911}, {-0.499500, -0.808200, -0.312100}},
    {{0.103224, 1.167021, 0.028502}, {1, 1, 1, 1}, {0.710103, 0.938134}, {-0.499500, -0.808200, -0.312100}},
    {{0.383715, 1.293136, -0.747009}, {1, 1, 1, 1}, {0.981093, 0.233833}, {-0.690800, -0.631300, -0.352500}},
    {{0.175616, 1.087808, 0.028502}, {1, 1, 1, 1}, {0.955812, 0.037171}, {-0.690800, -0.631300, -0.352500}},
    {{0.103224, 1.167021, 0.028502}, {1, 1, 1, 1}, {0.981093, 0.037245}, {-0.690800, -0.631300, -0.352500}},
    {{-0.186735, 1.000000, -0.080314}, {1, 1, 1, 1}, {0.934462, 0.382852}, {0.907600, 0.209900, -0.363600}},
    {{-0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.899252, 0.600006}, {0.907600, 0.209900, -0.363600}},
    {{-0.167020, 1.103225, 0.028502}, {1, 1, 1, 1}, {0.912950, 0.355106}, {0.907600, 0.209900, -0.363600}},
    {{-0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.899252, 0.600006}, {0.926100, -0.185700, -0.328300}},
    {{-0.403463, 1.249357, -0.721281}, {1, 1, 1, 1}, {0.855046, 0.544527}, {0.926100, -0.185700, -0.328300}},
    {{-0.167020, 1.103225, 0.028502}, {1, 1, 1, 1}, {0.912950, 0.355106}, {0.926100, -0.185700, -0.328300}},
    {{-0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.690522, 0.262718}, {-0.840900, 0.519700, 0.151400}},
    {{-0.146568, 1.293137, 0.555568}, {1, 1, 1, 1}, {0.743958, 0.248191}, {-0.840900, 0.519700, 0.151400}},
    {{-0.275016, 1.271247, -0.082856}, {1, 1, 1, 1}, {0.715860, 0.407620}, {-0.840900, 0.519700, 0.151400}},
    {{-0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.146573, 0.449808}, {-0.795800, 0.491800, 0.353400}},
    {{0.000000, 1.000000, 1.293472}, {1, 1, 1, 1}, {0.209631, 0.627292}, {-0.795800, 0.491800, 0.353400}},
    {{-0.146568, 1.293137, 0.555568}, {1, 1, 1, 1}, {0.098012, 0.457670}, {-0.795800, 0.491800, 0.353400}},
    {{0.000000, 1.000000, 1.293472}, {1, 1, 1, 1}, {0.766612, 0.079511}, {0.086800, 0.931600, 0.352900}},
    {{0.154106, 1.249357, 0.597206}, {1, 1, 1, 1}, {0.816786, 0.239721}, {0.086800, 0.931600, 0.352900}},
    {{-0.146568, 1.293137, 0.555568}, {1, 1, 1, 1}, {0.743958, 0.248191}, {0.086800, 0.931600, 0.352900}},
    {{0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.396913, 0.449808}, {0.822500, 0.546300, 0.158300}},
    {{0.383715, 1.293136, -0.747009}, {1, 1, 1, 1}, {0.402464, 0.115283}, {0.822500, 0.546300, 0.158300}},
    {{0.154106, 1.249357, 0.597206}, {1, 1, 1, 1}, {0.471795, 0.447263}, {0.822500, 0.546300, 0.158300}},
    {{0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.396913, 0.449808}, {0.917500, 0.377700, 0.124400}},
    {{0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.314005, 0.081821}, {0.917500, 0.377700, 0.124400}},
    {{0.383715, 1.293136, -0.747009}, {1, 1, 1, 1}, {0.402464, 0.115283}, {0.917500, 0.377700, 0.124400}},
    {{0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.899252, 0.281635}, {-0.915300, -0.253800, -0.312800}},
    {{0.175616, 1.087808, 0.028502}, {1, 1, 1, 1}, {0.955812, 0.037171}, {-0.915300, -0.253800, -0.312800}},
    {{0.383715, 1.293136, -0.747009}, {1, 1, 1, 1}, {0.981093, 0.233833}, {-0.915300, -0.253800, -0.312800}},
    {{-0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.063665, 0.081821}, {-0.924100, 0.361100, 0.125300}},
    {{-0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.146573, 0.449808}, {-0.924100, 0.361100, 0.125300}},
    {{-0.403463, 1.249357, -0.721281}, {1, 1, 1, 1}, {0.028885, 0.142979}, {-0.924100, 0.361100, 0.125300}},
    {{-0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.063665, 0.081821}, {-0.917500, -0.377700, 0.124400}},
    {{-0.383715, 0.706864, -0.747009}, {1, 1, 1, 1}, {0.152124, 0.115283}, {-0.917500, -0.377700, 0.124400}},
    {{-0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.146573, 0.449808}, {-0.917500, -0.377700, 0.124400}},
    {{-0.383715, 0.706864, -0.747009}, {1, 1, 1, 1}, {0.152124, 0.115283}, {-0.822500, -0.546300, 0.158300}},
    {{-0.154106, 0.750643, 0.597206}, {1, 1, 1, 1}, {0.221455, 0.447263}, {-0.822500, -0.546300, 0.158300}},
    {{-0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.146573, 0.449808}, {-0.822500, -0.546300, 0.158300}},
    {{0.000000, 1.000000, 1.293472}, {1, 1, 1, 1}, {0.459971, 0.627292}, {0.794500, 0.494300, 0.352900}},
    {{0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.396913, 0.449808}, {0.794500, 0.494300, 0.352900}},
    {{0.154106, 1.249357, 0.597206}, {1, 1, 1, 1}, {0.471795, 0.447263}, {0.794500, 0.494300, 0.352900}},
    {{0.000000, 1.000000, 1.293472}, {1, 1, 1, 1}, {0.459971, 0.627292}, {0.795800, -0.491800, 0.353400}},
    {{0.146568, 0.706863, 0.555568}, {1, 1, 1, 1}, {0.348352, 0.457670}, {0.795800, -0.491800, 0.353400}},
    {{0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.396913, 0.449808}, {0.795800, -0.491800, 0.353400}},
    {{0.146568, 0.706863, 0.555568}, {1, 1, 1, 1}, {0.576229, 0.248191}, {0.840900, -0.519700, 0.151400}},
    {{0.403463, 0.750643, -0.721281}, {1, 1, 1, 1}, {0.520033, 0.567050}, {0.840900, -0.519700, 0.151400}},
    {{0.327733, 1.000000, 0.555573}, {1, 1, 1, 1}, {0.522793, 0.262718}, {0.840900, -0.519700, 0.151400}},
    {{0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.899252, 0.281635}, {-0.878000, 0.324700, -0.351700}},
    {{0.186735, 1.000000, -0.080314}, {1, 1, 1, 1}, {0.934462, 0.064482}, {-0.878000, 0.324700, -0.351700}},
    {{0.175616, 1.087808, 0.028502}, {1, 1, 1, 1}, {0.955812, 0.037171}, {-0.878000, 0.324700, -0.351700}},
    {{0.530283, 1.000000, -0.937993}, {1, 1, 1, 1}, {0.899252, 0.281635}, {-0.907600, -0.209900, -0.363600}},
    {{0.167020, 0.896775, 0.028502}, {1, 1, 1, 1}, {0.912950, 0.036735}, {-0.907600, -0.209900, -0.363600}},
    {{0.186735, 1.000000, -0.080314}, {1, 1, 1, 1}, {0.934462, 0.064482}, {-0.907600, -0.209900, -0.363600}},
    {{-0.103224, 0.832979, 0.028502}, {1, 1, 1, 1}, {0.981093, 0.355616}, {0.690800, 0.631300, -0.352500}},
    {{-0.383715, 0.706864, -0.747009}, {1, 1, 1, 1}, {0.981093, 0.552203}, {0.690800, 0.631300, -0.352500}},
    {{-0.175616, 0.912192, 0.028502}, {1, 1, 1, 1}, {0.955812, 0.355542}, {0.690800, 0.631300, -0.352500}},
    {{-0.103224, 0.832979, 0.028502}, {1, 1, 1, 1}, {0.946842, 0.938134}, {0.499500, 0.808200, -0.312100}},
    {{-0.090581, 0.525699, -0.747011}, {1, 1, 1, 1}, {0.880561, 0.742084}, {0.499500, 0.808200, -0.312100}},
    {{-0.383715, 0.706864, -0.747009}, {1, 1, 1, 1}, {0.946842, 0.727911}, {0.499500, 0.808200, -0.312100}},
    {{-0.090581, 0.525699, -0.747011}, {1, 1, 1, 1}, {0.221455, 0.102733}, {-0.522100, -0.844800, 0.116700}},
    {{-0.154106, 0.750643, 0.597206}, {1, 1, 1, 1}, {0.221455, 0.447263}, {-0.522100, -0.844800, 0.116700}},
    {{-0.383715, 0.706864, -0.747009}, {1, 1, 1, 1}, {0.152124, 0.115283}, {-0.522100, -0.844800, 0.116700}},
    {{-0.103224, 0.832979, 0.028502}, {1, 1, 1, 1}, {0.076897, 0.726114}, {-0.000000, 0.000000, -1.000000}},
    {{-0.175616, 0.912192, 0.028502}, {1, 1, 1, 1}, {0.098325, 0.742340}, {-0.000000, 0.000000, -1.000000}},
    {{-0.186735, 1.000000, -0.080314}, {1, 1, 1, 1}, {0.105154, 0.763602}, {-0.000000, 0.000000, -1.000000}},
    {{0.167020, 0.896775, 0.028502}, {1, 1, 1, 1}, {0.882977, 0.964127}, {-0.218200, 0.905700, -0.363600}},
    {{0.237148, 0.525699, -0.937995}, {1, 1, 1, 1}, {0.787536, 0.724971}, {-0.218200, 0.905700, -0.363600}},
    {{0.083510, 0.832978, -0.080314}, {1, 1, 1, 1}, {0.893838, 0.928384}, {-0.218200, 0.905700, -0.363600}},
    {{0.237148, 0.525699, -0.937995}, {1, 1, 1, 1}, {0.787536, 0.724971}, {-0.683000, 0.640100, -0.351700}},
    {{0.000000, 0.803655, 0.028502}, {1, 1, 1, 1}, {0.923090, 0.945055}, {-0.683000, 0.640100, -0.351700}},
    {{0.083510, 0.832978, -0.080314}, {1, 1, 1, 1}, {0.893838, 0.928384}, {-0.683000, 0.640100, -0.351700}},
    {{-0.090581, 0.525699, -0.747011}, {1, 1, 1, 1}, {0.649056, 0.561931}, {-0.120800, -0.980000, 0.158300}},
    {{0.146568, 0.706863, 0.555568}, {1, 1, 1, 1}, {0.576229, 0.248191}, {-0.120800, -0.980000, 0.158300}},
    {{-0.154106, 0.750643, 0.597206}, {1, 1, 1, 1}, {0.649056, 0.239721}, {-0.120800, -0.980000, 0.158300}},
    {{-0.090581, 0.525699, -0.747011}, {1, 1, 1, 1}, {0.649056, 0.561931}, {0.072500, -0.989600, 0.124400}},
    {{0.237148, 0.525699, -0.937995}, {1, 1, 1, 1}, {0.569261, 0.609587}, {0.072500, -0.989600, 0.124400}},
    {{0.146568, 0.706863, 0.555568}, {1, 1, 1, 1}, {0.576229, 0.248191}, {0.072500, -0.989600, 0.124400}},
    {{0.237148, 0.525699, -0.937995}, {1, 1, 1, 1}, {0.569261, 0.609587}, {0.736200, -0.665100, 0.125300}},
    {{0.403463, 0.750643, -0.721281}, {1, 1, 1, 1}, {0.520033, 0.567050}, {0.736200, -0.665100, 0.125300}},
    {{0.146568, 0.706863, 0.555568}, {1, 1, 1, 1}, {0.576229, 0.248191}, {0.736200, -0.665100, 0.125300}},
};

@end
